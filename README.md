# web-security

Выполнил: Макаров Роман ДИС-213/21.Б

## 1 практическая (practice_1)

### Файл auth.js

В файле auth.js содержится метод auth, который принимает запрос (request) и ответ (response).

Извлекаем из req.body данные, такие как email (электронная почта), password (пароль) и rememberCheck (опция "запомнить вход").

Значение пользователя помещаем в константу user после получения его из базы данных.

Если пользователь с указанным email отсутствует, возвращаем статус 403.

Далее получаем роли пользователя с помощью геттера.

Сравниваем пароль, отправленный пользователем, с его кешем с помощью функции compare. Если пароль неверный, возвращаем статус 403.

Затем генерируем accessToken (токен аутентификации) и refreshToken (токен для сброса пароля).

Токены генерируются с использованием библиотеки jwt для приложений на nodeJS и функции sign.

В итоге отправляем обратно пользователю и сгенерированные токены.

![image](https://github.com/lissenko228/web-security/assets/73995545/609cbea9-3dfc-43e1-b506-fbc7497ca4b0)


### Файл middleware.js

В этом файле есть два middleware: user и admin. Они оба получают информацию об авторизации из заголовков запроса.

Затем используется функция verify из библиотеки jwt для проверки токена, секрета (который используется для шифрования jwt) и callback.

В коллбэке получаем потенциальные ошибки и расшифрованный объект с данными.

Далее проводится проверка на наличие ошибок и поиск пользователя в базе данных, используя расшифрованные данные.

Если ошибок нет и пользователь найден, происходит продолжение выполнения кода.

В middleware admin к проверке добавляется еще одно условие - наличие роли с уровнем доступа 1.

## 2 практическая (practice_2)

В файле auth.js выполнена проверка авторизации с использованием параметра токена из запроса.

Для этого извлекается токен из параметров запроса:

```
const { bearer } = req.params;
```
Далее происходит проверка токена с помощью jwt verify для проверки наличия ошибок и наличия пользователя в базе данных.

При отсутствии ошибок возвращается пользователь.

![image](https://github.com/lissenko228/web-security/assets/73995545/0a589c93-3e6c-4911-b4ed-8d0a8eab2884)

